# 要件定義書：YouTubeスポーツタグ付け拡張機能

## 1. 概要

YouTube映像の視聴中に、スポーツ分析用途で「アクション」と「ラベル」をタグ付けできるChrome拡張機能を開発する。映像上に表示されるUIを通じて簡単な操作でタイムスタンプ付きのアクション記録を行い、ローカルまたはGoogle Sheetsにエクスポート可能とする。

## 2. 目的

- スポーツの試合映像に対して、指導者や分析者が効率的にタグを付けられる環境を提供
- 映像を見ながらリアルタイムでのデータ収集を可能にする
- 試合後のフィードバックや振り返りの精度を高めるための可視化ツールを提供

## 3. 対象ユーザー

- 一般ユーザー（特にスポーツ指導者、部活動のコーチ、学生アナリストなど）

## 4. 対応プラットフォーム

- Google Chrome拡張機能（Plasmo + React + TypeScript）

## 5. 機能要件

### 5.1 映像上UI

- アクションボタン：ユーザー定義可能。押下でアクション開始／終了のタイムスタンプを記録
- ラベルボタン：アクション押下中に関連ラベルを複数付与可能
- ボタンはチーム単位でグルーピングして表示（例：チームA / チームB）
- UIの表示位置はドラッグ可能
- アクション・ラベルの色分け表示（今後対応予定）

### 5.2 データ記録

- アクション単位でデータ構造を保持
- タイムスタンプは `start` と `end` を記録（ミリ秒単位）
- **新機能：カテゴリ化されたラベル対応**
  - シンプル形式：文字列配列として保存 (`string[]`)
  - カテゴリ形式：カテゴリ別に整理 (`Record<string, string[]>`)
  - 両形式の後方互換性をサポート
- 複数ラベルはカンマ区切りで1セルに保存
- 同一タイムスタンプで複数アクションを記録可能（多重アクション許容）
- アクション完了時にローカルストレージへ自動保存
- タイムラインは動画単位（videoId）で保存

### 5.3 出力形式

- YouTube画面上にタイムラインパネルとして表示
  - **新機能：ブラケット記法表示** - カテゴリ化されたラベルを`[カテゴリ] 値`形式で表示
- ローカル出力：CSVファイルとして保存（1行＝1アクション）
  - **新機能：カテゴリ別列出力** - 各カテゴリが個別の列として出力
  - 列構成：`Team, Action, Start, End, [カテゴリ1], [カテゴリ2], ...`
  - カテゴリはアルファベット順でソート
  - 該当カテゴリがないアクションは空文字で出力
- **新機能：JSON インポート/エクスポート**
  - ボタンセット設定のJSONエクスポート機能
  - JSONファイルからのボタンセットインポート機能
  - 新旧両形式のラベル構造をサポート
- Google Sheets連携（認証を含む）：
  - 1アクション1行
  - 列構成：
    | Team | Action | Start | End | カテゴリ列... |
    |------|--------|-------|-----|-------------|

### 5.4 UIの構成要素

- `TaggingPanel`：アクション・ラベルボタン群（ドラッグ可能）
  - **新機能：カテゴリ別ラベル表示** - ラベルがカテゴリごとにグループ化されて表示
- `TimelinePanel`：現在の記録を表で表示・CSV出力・保存ボタンあり
  - **新機能：ブラケット記法表示** - `[カテゴリ] 値`形式でラベルを表示
  - クリックでジャンプ機能付きタイムスタンプ表示
- `Popup（設定画面）`：
  - チームの追加/削除
  - アクション/ラベルの管理（ButtonSet形式）
  - **新機能：JSON インポート/エクスポート機能**
  - **新機能：カテゴリ別ラベル管理UI**
  - UI可視性切り替え
  - 保存ボタンによりローカルストレージへ永続化

### 5.5 初期データプリセット

- アクション：例）Pass, Shoot, Tackle
- ラベル：例）Good, Bad, Miss, Try
- 最初からA/Bのボタンセットを提供（任意の変更可）

### 5.6 ユーザー定義可能なアクションとラベル

- UIからアクションおよびラベルの追加・削除・編集が可能
- **新機能：カテゴリ化されたラベル管理**
  - シンプル形式：従来の文字列配列形式 (`string[]`)
  - カテゴリ形式：カテゴリ別整理形式 (`Record<string, string[]>`)
  - カテゴリ別にラベルを追加・管理可能
- **新機能：JSON インポート/エクスポート**
  - 設定のJSONファイルへのエクスポート機能
  - JSONファイルからの設定インポート機能
  - 他のユーザーとの設定共有が可能
- 設定は `chrome.storage.local` にJSON形式で保存
- 編集後は即時反映される

### 5.7 タイムラインのシーク機能

- 表の `Start`, `End` をクリックするとYouTube動画を該当時刻へジャンプ
- `End` が存在しない場合、「進行中」として表示

### 5.8 データ形式とファイル構造

**ボタンセットのJSON形式:**

- **シンプル形式（レガシー）:**

```json
{
  "setName": "SOCCER",
  "buttons": [
    {
      "action": "pass",
      "labels": ["short pass", "long pass", "through pass"]
    }
  ]
}
```

- **カテゴリ形式（推奨）:**

```json
{
  "setName": "TENNIS",
  "buttons": [
    {
      "action": "serve",
      "labels": {
        "Result": ["ace", "fault", "double fault"],
        "Type": ["first serve", "second serve"]
      }
    }
  ]
}
```

**CSV出力形式:**

- 各カテゴリが個別の列として出力
- ヘッダー構成：`Team,Action,Start,End,[カテゴリ1],[カテゴリ2],...`
- タイムスタンプ付きファイル名：`actions_YYYY-MM-DD.csv`

**サンプルファイル:**

- `sample-soccer.json` - サッカー用ボタンセット（カテゴリ形式）
- `sample-basketball.json` - バスケットボール用ボタンセット（カテゴリ形式）
- `sample-tennis.json` - テニス用ボタンセット（カテゴリ形式）

## 6. 非機能要件

- 拡張機能は軽量でYouTube再生に干渉しない
- PlasmoによるSPA構造で、ナビゲーション変化にも対応
- 初回起動時でもプリセットデータで即利用可能
- 複数アクション同時記録、複数ラベル対応

## 7. 将来的な拡張

- ホットキー設定画面の提供（ショートカット操作による記録）
- YouTubeコメント欄にタイムスタンプを投稿
- タグ付けされたタイムラインのインタラクティブな再生UI
- チーム単位での共有・クラウド保存機能
- ユーザー間でのプリセットテンプレート共有
